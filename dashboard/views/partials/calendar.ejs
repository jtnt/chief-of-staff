<% if (calendarData.nextUp) { %>
  <div class="next-up-card">
    <div class="next-up-header">
      <span class="next-up-label">Next Up</span>
      <span class="countdown-badge">in <%= calendarData.nextUp.countdown %></span>
    </div>
    <div class="next-up-title"><%= calendarData.nextUp.summary %></div>
    <div class="next-up-time">
      <%= new Date(calendarData.nextUp.start).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }) %> - <%= new Date(calendarData.nextUp.end).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }) %>
    </div>
    <% if (calendarData.nextUp.attendees && calendarData.nextUp.attendees.length > 0) { %>
      <div class="next-up-attendees">
        <% const displayAttendees = calendarData.nextUp.attendees.filter(a => !a.self).slice(0, 4); %>
        <% displayAttendees.forEach(attendee => { %>
          <span class="attendee-chip" title="<%= attendee.email %>">
            <%= attendee.displayName || attendee.email.split('@')[0] %>
          </span>
        <% }) %>
        <% if (calendarData.nextUp.attendees.filter(a => !a.self).length > 4) { %>
          <span class="attendee-more">+<%= calendarData.nextUp.attendees.filter(a => !a.self).length - 4 %> more</span>
        <% } %>
      </div>
    <% } %>
    <% if (calendarData.nextUp.location) { %>
      <div class="next-up-location"><%= calendarData.nextUp.location %></div>
    <% } %>
    <div class="next-up-actions">
      <% if (calendarData.nextUp.meetLink) { %>
        <a href="<%= calendarData.nextUp.meetLink %>" target="_blank" class="btn-join">Join Now</a>
      <% } %>
      <a href="<%= calendarData.nextUp.htmlLink %>" target="_blank" class="btn-prep">View in Calendar</a>
    </div>
  </div>
<% } %>

<div class="card">
  <div class="card-header">
    <h3>Today's Schedule</h3>
    <button class="btn-archive" hx-get="/api/calendar/refresh" hx-target="#schedule" hx-swap="innerHTML">
      Refresh
    </button>
  </div>
  <div class="card-body" id="schedule">
    <% if (calendarData.error) { %>
      <div class="error-message"><%= calendarData.error %></div>
    <% } else if (calendarData.events.length === 0) { %>
      <div class="empty-state">No events today</div>
    <% } else { %>
      <% if (calendarData.allDay && calendarData.allDay.length > 0) { %>
        <div class="schedule-section">
          <h4>All Day</h4>
          <% calendarData.allDay.forEach(e => { %>
            <div class="event-item">
              <span class="all-day-badge">All Day</span>
              <div class="event-details">
                <div class="event-title"><%= e.summary %></div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>

      <% if (calendarData.morning && calendarData.morning.length > 0) { %>
        <div class="schedule-section">
          <h4>Morning</h4>
          <% calendarData.morning.forEach(e => { %>
            <div class="event-item">
              <span class="event-time"><%= new Date(e.start).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }) %></span>
              <div class="event-details">
                <div class="event-title"><%= e.summary %></div>
                <% if (e.location) { %>
                  <div class="event-location"><%= e.location %></div>
                <% } %>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>

      <% if (calendarData.afternoon && calendarData.afternoon.length > 0) { %>
        <div class="schedule-section">
          <h4>Afternoon</h4>
          <% calendarData.afternoon.forEach(e => { %>
            <div class="event-item">
              <span class="event-time"><%= new Date(e.start).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }) %></span>
              <div class="event-details">
                <div class="event-title"><%= e.summary %></div>
                <% if (e.location) { %>
                  <div class="event-location"><%= e.location %></div>
                <% } %>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    <% } %>
  </div>
</div>
